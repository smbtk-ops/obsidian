apt — это основной пакетный менеджер в Debian-подобных системах (Debian, Ubuntu и др.), который объединяет функционал apt-get и apt-cache с более удобным интерфейсом.

## **Основные ключи команды apt**

| **Ключ**         | **Описание**                                                                                             |
| ---------------- | -------------------------------------------------------------------------------------------------------- |
| update           | Обновляет список доступных пакетов и их версий.                                                          |
| upgrade          | Обновляет установленные пакеты до последних доступных версий.                                            |
| full-upgrade     | Аналогично upgrade, но может удалять устаревшие или конфликтующие пакеты.                                |
| install <пакет>  | Устанавливает указанный пакет.                                                                           |
| remove <пакет>   | Удаляет указанный пакет (оставляя конфиги).                                                              |
| purge <пакет>    | Удаляет пакет вместе с его конфигурационными файлами.                                                    |
| autoremove       | Удаляет пакеты, установленные как зависимости и больше не нужные.                                        |
| search <шаблон>  | Ищет пакеты по ключевому слову.                                                                          |
| show <пакет>     | Показывает подробную информацию о пакете.                                                                |
| list             | Показывает список пакетов (установленных, доступных и др.).                                              |
| depends <пакет>  | Показывает зависимости пакета.                                                                           |
| rdepends <пакет> | Показывает обратные зависимости (что зависит от этого пакета).                                           |
| edit-sources     | Открывает файл /etc/apt/sources.list в редакторе для изменения списка репозиториев.                      |
| clean            | Очищает загруженные пакеты (кэш: /var/cache/apt/archives/). Удаляет все файлы .deb, которые уже скачаны. |
| autoclean        | Удаляет только устаревшие пакеты из кэша, которые больше недоступны для загрузки.                        |
|                  |                                                                                                          |

## **Часто используемые флаги**

|**Ключ**|**Описание**|
|---|---|
|-y|Автоматически отвечает “yes” на все запросы.|
|-q|Тихий режим работы (уменьшает количество вывода).|
|--reinstall|Переустанавливает пакет.|
|--fix-broken|Попытка исправить проблемы с зависимостями пакетов.|
|--no-install-recommends|Устанавливает только основной пакет без рекомендуемых зависимостей.|

## **Примеры использования:**

### **Обновить список пакетов:**
```
apt update
```

### **Обновить все пакеты до последних версий:**
```
apt upgrade -y
```

### **Установить пакет vim:**
```
apt install vim
```

### **Установить пакет без рекомендуемых зависимостей:**
```
apt install --no-install-recommends vim
```

### **Удалить пакет vim:**
```
apt remove vim
```

### **Удалить пакет vim вместе с его конфигурацией:**
```
apt purge vim
```

### **Найти пакеты с названием, содержащим nginx:**
```
apt search nginx
```

### **Показать информацию о пакете curl:**
```
apt show curl
```

### **Автоматическая очистка неиспользуемых зависимостей:**
```
apt autoremove
```

### **Обновить дистрибутив полностью (включая возможное удаление старых пакетов):**
```
apt full-upgrade
```

# **Команда apt-cache madison**

apt-cache madison — это команда, которая показывает доступные версии пакета и их соответствие репозиториям. Очень полезна, когда нужно посмотреть все доступные версии пакета и их источник (репозиторий), особенно если ты работаешь с разными версиями ПО.

## **Синтаксис**
```
apt-cache madison <пакет>
```

## **Что выводит:**

|**Поле**|**Описание**|
|---|---|
|Пакет|Название пакета.|
|Версия|Доступная версия пакета.|
|Репозиторий|Откуда именно берётся этот пакет (URL/путь в репозитории).|

## **Пример использования**

### **Посмотреть все доступные версии пакета nginx:**
```
apt-cache madison nginx
```

**Пример вывода:**
```
 nginx | 1.22.1-1~bionic | http://ppa.launchpad.net/nginx/stable/ubuntu bionic/main amd64 Packages
 nginx | 1.18.0-0ubuntu1 | http://archive.ubuntu.com/ubuntu focal/main amd64 Packages
```

- название пакета (nginx);
- версии (1.22.1-1~bionic, 1.18.0-0ubuntu1);
- путь к репозиторию.

## **Когда это нужно:**

- Чтобы **выбрать нужную версию** для установки с помощью команды:
```
apt install nginx=1.18.0-0ubuntu1
```
    
- Для **проверки, из какого репозитория подтягивается версия**, особенно если настроено несколько источников.
- При откате пакета на более старую версию или для уточнения, доступна ли нужная версия в репо.

**Важно:**
Если madison ничего не показывает, возможно, нужно выполнить:
```
apt update
```
чтобы обновить кэш, либо убедиться, что нужный репозиторий действительно подключён.

# В случае, если нам необходимо зафиксировать конкретную версию пакета на хосте, 

можно воспользоваться командой `apt-mark hold $PACKAGE`, после которой пакет не будет обновляться в ходе `upgrade`. Это можно впоследствии отменить через `apt-mark unhold $PACKAGE`.