# **dpkg**

dpkg — низкоуровневая утилита для установки, удаления и управления пакетами .deb в Debian-подобных системах (Ubuntu и др.). Обычно используется вместе с apt, но позволяет напрямую управлять локальными пакетами.

### **Основные ключи команды dpkg**

|**Ключ**|**Описание**|**Пример**|
|---|---|---|
|-i, --install|Устанавливает пакет из файла .deb.|dpkg -i mypackage.deb|
|-r, --remove|Удаляет установленный пакет **без** удаления конфигурационных файлов.|dpkg -r mypackage|
|-P, --purge|Полностью удаляет пакет **с конфигурационными файлами**.|dpkg -P mypackage|
|-l [шаблон], --list [шаблон]|Показывает список установленных пакетов (с шаблоном или без).|dpkg -l / dpkg -l 'python*'|
|-L, --listfiles|Показывает файлы, установленные данным пакетом.|dpkg -L nginx|
|-S, --search|Ищет, какой пакет содержит указанный файл.|dpkg -S /usr/bin/python3|
|-s, --status|Показывает информацию о статусе пакета.|dpkg -s nginx|
|--get-selections|Показывает список всех пакетов и их статус (установлен/удален и др.).|dpkg --get-selections|
|--set-selections|Восстанавливает список пакетов из файла (в паре с --get-selections).|dpkg --set-selections < packages.txt|
|--configure [пакет]|Настраивает установленный пакет (часто после ошибки установки).|dpkg --configure nginx|
|--audit|Проверяет систему на наличие повреждённых или недонастроенных пакетов.|dpkg --audit|

### **Диагностика и исправление ошибок**

|**Ключ**|**Описание**|**Пример**|
|---|---|---|
|--force-*|Игнорировать некоторые ошибки (например, несовпадение зависимостей, перезапись файлов и др.).|dpkg -i --force-overwrite mypackage.deb|
|--clear-avail|Очищает кэш информации о доступных пакетах.|dpkg --clear-avail|
|--print-architecture|Показывает архитектуру системы (например, amd64).|dpkg --print-architecture|
|--print-foreign-architectures|Показывает список дополнительных архитектур, поддерживаемых системой.|dpkg --print-foreign-architectures|

### **Полезные сценарии**

**Установить локальный .deb пакет:**
```
dpkg -i ./google-chrome-stable_current_amd64.deb
```

**Исправить незавершённую установку (например, после ошибки):**
```
dpkg --configure -a
```

**Удалить пакет полностью с конфигами:**
```
dpkg -P nginx
```

**Найти, какой пакет содержит файл:**
```
dpkg -S /usr/bin/curl
```

**Посмотреть все файлы, установленные с пакетом:**
```
dpkg -L openssh-server
```

- dpkg **не управляет зависимостями автоматически**. Если при установке пакета появляются ошибки о недостающих зависимостях, их нужно установить вручную или воспользоваться apt:
```
sudo apt install -f
```

- Для массовой работы с пакетами обычно предпочтительнее использовать apt, но dpkg незаменим при установке локальных .deb файлов и при диагностике проблем.
