## **Файл limits.conf**

Файл /etc/security/limits.conf используется для задания лимитов на ресурсы для пользователей.

### **Формат строки:**
```
<домен>   <тип>   <параметр>   <значение>
```
- **домен**:
    - имя пользователя (например, dolan)
    - имя группы (@admins)
    - * — для всех пользователей
    - %group — для ограничения числа входов в систему (maxlogins)
    
- **тип**:
    - soft — мягкий лимит, может быть изменён пользователем
    - hard — жёсткий лимит, может быть изменён только суперпользователем
    
- **параметр**:

|**Параметр**|**Описание**|
|---|---|
|core|Максимальный размер дампа памяти (KB)|
|data|Максимальный размер данных в памяти (KB)|
|fsize|Максимальный размер файла (KB)|
|memlock|Максимальный объём памяти, который можно закрепить в RAM (KB)|
|nofile|Максимальное количество открытых файлов|
|rss|Максимальный размер физической памяти (KB)|
|stack|Максимальный размер стека (KB)|
|cpu|Максимальное процессорное время (минуты)|
|nproc|Максимальное количество процессов|
|as|Максимальный размер адресного пространства (KB)|
|maxlogins|Максимальное количество одновременных входов|
|maxsyslogins|Максимальное количество входов в систему|
|priority|Приоритет запуска процессов|
|locks|Максимальное количество блокировок файлов|
|sigpending|Максимальное количество ожидающих сигналов|
|msgqueue|Максимальный размер очередей сообщений POSIX (байты)|
|nice|Максимальный уровень nice (от -20 до 19)|
|rtprio|Максимальный приоритет реального времени|

### **Пример limits.conf:**

|**Задача**|**Строка для limits.conf**|**Пояснение**|
|---|---|---|
|Ограничить количество процессов для пользователя john до 100|john  hard  nproc  100|Пользователь john не сможет создать больше 100 процессов|
|Ограничить размер файлов до 500 МБ для всех пользователей|*  hard  fsize  512000|Ограничение в килобайтах (500 × 1024 = 512000 KB)|
|Запретить создание core-файлов всем пользователям|*  soft  core  0|Установка размера core-файла в 0 KB|
|Разрешить безлимитное открытие файлов для пользователя admin|admin  hard  nofile  unlimited|Полная отмена ограничения на количество открытых файлов|
|Ограничить размер стека до 8 МБ для всех пользователей|*  soft  stack  8192|Ограничение на размер стека в килобайтах|
|Ограничить количество одновременно открытых файлов до 2048 для группы developers|@developers  soft  nofile  2048|Ограничение только для группы developers|
|Ограничить количество одновременных логинов для группы students до 5|%students  hard  maxlogins 5|Используется %, так как ограничение на maxlogins|
|Установить приоритет процессов для пользователя serviceuser на -5|serviceuser  hard  priority  -5|Повышение приоритета процессов пользователя|
|Ограничить использование оперативной памяти до 2 ГБ для всех пользователей|*  hard  rss  2097152|Ограничение на физическую память в KB (2×1024×1024)|
|Установить лимит на очередь сообщений POSIX в 1 МБ для всех пользователей|*  hard  msgqueue  1048576|1 МБ в байтах|


**Примечание:**
- **unlimited** — означает отсутствие лимита.
- Все размеры указываются в килобайтах (кроме msgqueue — в байтах).
- Лимиты применяются при новой сессии (перезаход в систему).

## **Переопределение лимитов**

Файлы в /etc/security/limits.d/ могут переопределять настройки из limits.conf, если:
- домен тот же или более специфичный;
- файлы читаются в алфавитном порядке.

## **Утилита ulimit**

Позволяет просматривать и менять **soft limits** в текущей сессии оболочки.

### **Посмотреть все лимиты:**
```
ulimit -a
```
### **Изменить конкретный лимит:**
```
ulimit -Sn 4096  # увеличить количество открытых файлов (soft limit)
ulimit -Hn 8192  # изменить жёсткий лимит (требуются права суперпользователя)
```

| **Ключ** | **Параметр**         | **Описание**                      |
| -------- | -------------------- | --------------------------------- |
| -c       | core file size       | Размер core-файла                 |
| -d       | data seg size        | Размер сегмента данных            |
| -f       | file size            | Размер файла                      |
| -l       | max locked memory    | Размер зафиксированной памяти     |
| -n       | open files           | Количество открытых файлов        |
| -p       | pipe size            | Размер канала                     |
| -q       | POSIX message queues | Очереди сообщений POSIX           |
| -r       | real-time priority   | Приоритет реального времени       |
| -s       | stack size           | Размер стека                      |
| -t       | cpu time             | Процессорное время                |
| -u       | max user processes   | Количество процессов пользователя |
| -v       | virtual memory       | Объём виртуальной памяти          |
| -x       | file locks           | Блокировки файлов                 |
### **Особенности ulimit:**
- Изменения действуют только в текущей оболочке.
- После выхода из оболочки лимиты возвращаются к значениям из /etc/security/limits.conf.

## **Итоги**
- Ограничения на ресурсы настраиваются через /etc/security/limits.conf.
- Есть два типа лимитов: **soft** (изменяемый пользователем) и **hard** (изменяемый только root).
- ulimit позволяет временно изменить soft-лимиты в текущей сессии.


## **Полезные ссылки**

- [Ulimit и настройка проблем в Linux](https://example.com)
- [limits.conf и лимиты ресурсов](https://example.com)
- [Руководство по настройке ulimit для InfoSphere Streams](https://example.com)
- [limits.conf на ArchWiki](https://wiki.archlinux.org/title/Limits.conf)
